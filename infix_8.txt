infix.y

/* infix.y */
%{
#include <stdio.h>
#include <stdlib.h>
%}

/* semantic value: store numbers in d (double) */
%union {
    double d;
}

%token <d> NUMBER
%type  <d> expr

/* precedence and associativity */
%left '+' '-'
%left '*' '/'
%right UMINUS   /* unary minus (and unary plus) */

%%
input:
      /* empty */
    | input line
    ;

line:
      '\n'
    | expr '\n'   { printf("Result = %g\n", $1); }
    ;

expr:
      NUMBER                 { $$ = $1; }
    | expr '+' expr          { $$ = $1 + $3; }
    | expr '-' expr          { $$ = $1 - $3; }
    | expr '*' expr          { $$ = $1 * $3; }
    | expr '/' expr          {
                                if ($3 == 0.0) {
                                  yyerror("division by zero");
                                  $$ = 0;
                                } else {
                                  $$ = $1 / $3;
                                }
                              }
    | '(' expr ')'           { $$ = $2; }
    | '-' expr  %prec UMINUS { $$ = -$2; }   /* unary minus */
    | '+' expr  %prec UMINUS { $$ =  $2; }   /* unary plus */
    ;
%%

int main(void) {
    printf("Enter infix expressions (one per line). Ctrl+D to quit.\n");
    yyparse();
    return 0;
}

int yyerror(char *s) {
    fprintf(stderr, "Error: %s\n", s);
    return 0;
}


infix.l

/* infix.l */
%option noyywrap

%{
#include <stdio.h>
#include <stdlib.h>
#include "infix.tab.h"   /* generated by bison -d infix.y */
%}

/* rules */
%%
[0-9]+(\.[0-9]+)?([eE][+-]?[0-9]+)?    {
                                         /* floating or integer literal */
                                         yylval.d = atof(yytext);
                                         return NUMBER;
                                       }

[ \t]+                                 { /* skip spaces and tabs */ }

\n                                     { return '\n'; }

"(" | ")" | "+" | "-" | "*" | "/"      { return yytext[0]; }

.                                      { /* ignore any other single character */
                                         /* optionally: fprintf(stderr,"Ignoring: %s\n", yytext); */
                                       }
%%

sudo apt update
sudo apt install flex bison build-essential

flex infix.l
bison -d infix.y       # produces infix.tab.c and infix.tab.h
gcc lex.yy.c infix.tab.c -o infix -lm
./infix


